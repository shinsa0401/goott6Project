<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.boritgogae.orderMapper">
	<!-- 장바구니 -->
	<insert id="addCart">
		insert into cart (prodNo, memberId, qty, sessionId,sessionLimit)
		values('CB1AR05W00M03S03C00E00',null,1 ,'7as8d787s8a78dada',now())
	</insert>
	<select id="selectCartList"
		resultType="com.boritgogae.domain.CartDTO">
		select * from cart where memberId='haha' or sessionId =''
	</select>
	<delete id="delCartProd">
		delete from cart where memberId='haha' and prodNo='CB1AR05W00M03S03C00E00'
	</delete>
	<select id="popularList" resultType="DetailOrderVo">
		select count(prodNo) as orderCnt, prodNo from detailOrder group by prodNo order
		by orderCnt desc limit 0,6
	</select>

	<!-- 비회원 로그인하기위해 주문내역 검색 -->
	<select id="selectGuestOrderInfo" resultType="OrdersVo">
		select * from orders where name = #{name} and phoneNumber = #{phoneNumber}
		and guestPwd = sha1(md5(#{guestPwd}))
	</select>

	<!-- 관리자 주문조회용 -->
	<select id="getOrders" resultType="OrdersVo">
		select * from orders order by orderNo desc limit #{StartNum}, #{PostPerPage}
	</select>

	<!-- 관리자 주문상세조회용 -->
	<select id="getOrdersDetailInfo" resultType="OrderDetailDTO">
		select p.originalFile ,o.*,d.deliveryStatus
		from detailOrder as o, delivery as d, prodImg as p
		where o.orderDetailNo = d.orderDetailNo and d.orderNo = #{orderNo} and p.prodNo = o.prodNo
	</select>
	
	<!-- 관리자 TodoList -->
	<select id="AdminTodoList" resultType="OrderDetailDTO">
		select o.*,d.deliveryStatus from detailOrder as o, delivery as d
		 where o.orderDetailNo = d.orderDetailNo and (d.deliveryStatus = '교환요청' or d.deliveryStatus = '반품요청' or d.deliveryStatus = '취소' or d.deliveryStatus = '결제완료' or d.deliveryStatus = '배송전')
	</select>
	
	<!-- 주문 카운트 -->
	<select id="countOrder" resultType="int">
		select count(*) from orders
	</select>

	<!-- 관리자 승인주문 -->
	<select id="adminAllowOrders" resultType="int">
		select count(*) from detailOrder as o, delivery as d
		 where o.orderDetailNo = d.orderDetailNo and (d.deliveryStatus = '교환요청' or d.deliveryStatus = '반품요청' or d.deliveryStatus = '취소' or d.deliveryStatus = '결제완료')
	</select>

</mapper>